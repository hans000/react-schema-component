import{g as z,m as B,_ as F,e as O,f as b,r as m,h as A,c as N,o as U,R as u,i as T,a as S}from"./index-7e4a4b07.js";import{t as w}from"./throttleByAnimationFrame-ade9e9c6.js";const L=n=>{const{componentCls:f}=n;return{[f]:{position:"fixed",zIndex:n.zIndexPopup}}},I=z("Affix",n=>{const f=B(n,{zIndexPopup:n.zIndexBase+10});return[L(f)]});function g(n){return n!==window?n.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function C(n,f,r){if(r!==void 0&&f.top>n.top-r)return r+f.top}function R(n,f,r){if(r!==void 0&&f.bottom<n.bottom+r){const e=window.innerHeight-f.bottom;return r+e}}const P=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function _(){return typeof window<"u"?window:null}var h;(function(n){n[n.None=0]="None",n[n.Prepare=1]="Prepare"})(h||(h={}));let E=function(n){F(r,n);var f=O(r);function r(){var e;return b(this,r),e=f.apply(this,arguments),e.state={status:h.None,lastAffix:!1,prevTarget:null},e.placeholderNodeRef=m.createRef(),e.fixedNodeRef=m.createRef(),e.addListeners=()=>{const t=e.getTargetFunc(),o=t?.(),{prevTarget:i}=e.state;i!==o&&(P.forEach(a=>{i?.removeEventListener(a,e.lazyUpdatePosition),o?.addEventListener(a,e.lazyUpdatePosition)}),e.updatePosition(),e.setState({prevTarget:o}))},e.removeListeners=()=>{e.timer&&(clearTimeout(e.timer),e.timer=null);const{prevTarget:t}=e.state,o=e.getTargetFunc(),i=o?.();P.forEach(a=>{i?.removeEventListener(a,e.lazyUpdatePosition),t?.removeEventListener(a,e.lazyUpdatePosition)}),e.updatePosition.cancel(),e.lazyUpdatePosition.cancel()},e.getOffsetTop=()=>{const{offsetBottom:t,offsetTop:o}=e.props;return t===void 0&&o===void 0?0:o},e.getOffsetBottom=()=>e.props.offsetBottom,e.measure=()=>{const{status:t,lastAffix:o}=e.state,{onChange:i}=e.props,a=e.getTargetFunc();if(t!==h.Prepare||!e.fixedNodeRef.current||!e.placeholderNodeRef.current||!a)return;const c=e.getOffsetTop(),p=e.getOffsetBottom(),l=a();if(l){const d={status:h.None},s=g(e.placeholderNodeRef.current);if(s.top===0&&s.left===0&&s.width===0&&s.height===0)return;const x=g(l),v=C(s,x,c),y=R(s,x,p);v!==void 0?(d.affixStyle={position:"fixed",top:v,width:s.width,height:s.height},d.placeholderStyle={width:s.width,height:s.height}):y!==void 0&&(d.affixStyle={position:"fixed",bottom:y,width:s.width,height:s.height},d.placeholderStyle={width:s.width,height:s.height}),d.lastAffix=!!d.affixStyle,i&&o!==d.lastAffix&&i(d.lastAffix),e.setState(d)}},e.prepareMeasure=()=>{e.setState({status:h.Prepare,affixStyle:void 0,placeholderStyle:void 0})},e.updatePosition=w(()=>{e.prepareMeasure()}),e.lazyUpdatePosition=w(()=>{const t=e.getTargetFunc(),{affixStyle:o}=e.state;if(t&&o){const i=e.getOffsetTop(),a=e.getOffsetBottom(),c=t();if(c&&e.placeholderNodeRef.current){const p=g(c),l=g(e.placeholderNodeRef.current),d=C(l,p,i),s=R(l,p,a);if(d!==void 0&&o.top===d||s!==void 0&&o.bottom===s)return}}e.prepareMeasure()}),e}return A(r,[{key:"getTargetFunc",value:function(){const{getTargetContainer:t}=this.context,{target:o}=this.props;return o!==void 0?o:t??_}},{key:"componentDidMount",value:function(){this.timer=setTimeout(this.addListeners)}},{key:"componentDidUpdate",value:function(t){this.addListeners(),(t.offsetTop!==this.props.offsetTop||t.offsetBottom!==this.props.offsetBottom)&&this.updatePosition(),this.measure()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"render",value:function(){const{affixStyle:t,placeholderStyle:o}=this.state,{affixPrefixCls:i,rootClassName:a,children:c}=this.props,p=N(t&&a,{[i]:!!t});let l=U(this.props,["prefixCls","offsetTop","offsetBottom","target","onChange","affixPrefixCls","rootClassName"]);return u.createElement(T,{onResize:this.updatePosition},u.createElement("div",Object.assign({},l,{ref:this.placeholderNodeRef}),t&&u.createElement("div",{style:o,"aria-hidden":"true"}),u.createElement("div",{className:p,ref:this.fixedNodeRef,style:t},u.createElement(T,{onResize:this.updatePosition},c))))}}]),r}(u.Component);E.contextType=S;const M=m.forwardRef((n,f)=>{const{prefixCls:r,rootClassName:e}=n,{getPrefixCls:t}=m.useContext(S),o=t("affix",r),[i,a]=I(o),c=Object.assign(Object.assign({},n),{affixPrefixCls:o,rootClassName:N(e,a)});return i(u.createElement(E,Object.assign({},c,{ref:f})))});export{M as default};
